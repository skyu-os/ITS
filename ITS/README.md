# ITS 智能交通与商圈分析

一个基于高德地图的前端示例项目，集成了交通态势可视化、路线规划、天气查询，以及“商圈分析”报告（道路拥堵统计、形状一致性核查、公共交通与人流代理密度、公交线路覆盖采样、可导出报告）。

## 功能特性

- 交通态势
  - 支持矩形/圆形两种查询范围，半径可调，自动刷新可选。
  - 地图上以折线覆盖物展示道路态势，点击高亮并弹出信息窗（道路名、态势、速度、方向）。
- 路线规划
  - 驾车/步行/骑行/公交换乘（出租车以驾车替代）多模式。
  - 驾车策略（如`LEAST_TIME`）与是否显示路况可配置。
- 天气查询
  - 实时天气与未来预报，随城市切换更新。
- 商圈分析
  - 道路统计：拥堵/缓行/畅通数量，Top拥堵道路。
  - 一致性核查：对比矩形与圆形查询结果的不一致比率及样本差异。
  - 公共交通密度：公交站/地铁站密度（km²）。
  - 行人流代理：商场/餐饮/景点等POI密度。
  - 公交线路覆盖（采样）：基于采样站点统计每站覆盖线路数、运营窗口与Top站点。
  - 可视化：SVG柱状图展示道路态势分布。
  - 导出：一键导出分析报告为`HTML`文件。

## 目录结构

```
ITS/
├── assets/
│   ├── app.js        # 主要前端逻辑与分析实现
│   └── style.css     # 页面样式
├── index.html        # 页面入口，加载高德JS与各功能模块
├── 插件/             # 预留目录
└── 模板/             # 预留目录
```

## 快速开始

- 环境准备：
  - 现代浏览器（建议 Chrome/Edge）。
  - 安装 Python（用于本地静态服务器）。
- 启动本地服务器：
  - Windows：`py -m http.server 8000`
  - 通用：`python -m http.server 8000`
- 打开浏览器访问：`http://localhost:8000/`

## 使用指南

- 城市与天气
  - 在“城市”输入框填写城市名称（如`杭州市`），点击“切换城市”。
  - 点击“实时天气”、“天气预报”分别查询展示结果。

- 路线规划
  - 在“起点/终点”输入地址或经纬度（格式：`lng,lat`）。
  - 选择模式（驾车/步行/骑行/公交），驾车可设置策略与显示路况。
  - 点击“开始路线规划”查看面板详情。

- 交通态势
  - 在“交通态势查询”区域填写你的高德`Web 服务 Key`（REST API Key）。
  - 选择查询类型（矩形/圆形）与半径，点击“查询”。
  - 地图上显示道路折线；点击折线弹出详情，支持自动刷新。

- 商圈分析
  - 在“商圈分析”区域填入半径（建议`1–3 km`）与`Web 服务 Key`。
  - 点击“开始分析”，在右侧面板查看：
    - 道路总数、拥堵/缓行/畅通数量、Top拥堵道路（升序）。
    - 一致性核查：矩形 vs 圆形的不一致比率与各自特有样本。
    - 公共交通与人流代理密度（km²）。
    - 公交线路覆盖（采样站点）：平均每站线路数、线路最多的站与Top 3站，运营窗口（分钟，支持跨天）。
    - SVG柱状图与查询时间。
  - 点击“导出报告”生成`商圈分析报告.html`。

## API与数据来源

- 高德地图 JavaScript API：页面地图渲染与交互。
- REST API（需`Web 服务 Key`）：
  - 交通态势：`v3/traffic/status/rectangle`、`v3/traffic/status/circle`。
  - 周边POI：`v3/place/around`（公交/地铁/商场/餐饮/景点）。
  - 公交站查询：`v3/bus/stopname`（返回站点途经线路与首/末班时间）。

## 常见问题与排查

- Key类型错误或平台不匹配
  - 填写“`Web 服务 Key (REST)`”，不要使用“JSAPI 浏览器端 Key”。
  - 高德控制台确保启用“Web服务”，并检查白名单/来源设置。
  - 若提示`USERKEY_PLAT_NOMATCH`，请核对 Key 使用场景与平台。

- 城市支持性
  - 部分接口可能限制城市支持范围；当前城市不支持时报告面板会给出核查建议。

- 采样与配额
  - 公交线路覆盖使用最多12个站点采样，以减少频繁请求；如遇限频可降低采样数量。

- 加载外部样式或脚本错误
  - 若见`net::ERR_ABORTED`等从`webapi.amap.com`加载失败，通常为网络或Key导致；只要核心功能正常可忽略样式加载错误。

## 开发与定制

- 样式：修改`assets/style.css`自定义主题与布局。
- 逻辑：主要在`assets/app.js`：
  - `queryTrafficStatus`：交通态势查询与渲染。
  - `doRoute`：路线规划入口与模式策略。
  - `analyzeBizArea`：商圈分析报告渲染、形状一致性核查、公共交通与人流代理统计、公交线路覆盖采样。
  - `exportBizReport`：导出当前报告面板为`HTML`。
  - `fetchPlaceAround`、`fetchBusStopLines`、`timeStrToMinutes`：辅助数据查询与处理。

## 提交到 GitHub

- 初始化并提交：
  - `git init`
  - `git add .`
  - `git commit -m "Init ITS project with README"`
- 创建远程并推送：
  - `git remote add origin <your_repo_url>`
  - `git push -u origin main`（或`master`）

## 许可

本项目为示例性质，未附加开源许可文件。如需开源，建议根据实际情况添加合适的许可（如 MIT）。

## 致谢

- 高德地图 JSAPI 与 Web 服务 API。
- 社区对城市交通数据可视化与分析的最佳实践支持。